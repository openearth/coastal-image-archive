<?xml version="1.0" encoding="utf-8"?>
<dimConfigurationPart xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="/opt/dim/etc/schema/dimConfiguration.xsd">
{% for dataset in item.datasets %}
    <dataset id="{{ item.id }}_{{ dataset.id }}">
        <workDirectory>${workDirectory}/${dataset@id}</workDirectory>
    {% if dataset.cronentry is defined %}
        <cronentry>{{ dataset.cronentry }}</cronentry>
    {% else %}
        <cronentry>{{ dim_cronentry }}</cronentry>
    {% endif %}
        <cleanup active="true">
            <period>{{ dim_cleanup_period }}</period>
        </cleanup>
        <source id="{{ item.id }}">
            <site ref="{{ item.id }}"/>
            <remoteDirectory>{{ dim_source_directory }}</remoteDirectory>
            <includePattern>*.jpg</includePattern>
            <recursive>false</recursive>
        {% if item.maximum_file_age is defined %}
            <maximumFileAge>{{ item.maximum_file_age }}</maximumFileAge>
        {% endif %}
            <cleanup>false</cleanup>
        </source>
        <targets id="01-{{ dataset.id }}">
            <recursive>false</recursive>
            <actions id="01-rename">
                <action id="01-rename">
                    <command>
                       <executable>/bin/bash {{ dim_config_dir }}/rename.sh</executable>
                       <arguments>%SOURCE_DIRECTORY% %TARGET_DIRECTORY% {{ item.id }}</arguments>
                    </command>
                </action>
            </actions>
            <target active="true" id="01-backup">
                <localDirectory>{{ dim_target_directory }}</localDirectory>
            </target>
        </targets>
    </dataset>
{% endfor %}
</dimConfigurationPart>
